<app-header></app-header>

<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-body">
          <h2 class="card-title">Translation Training</h2>
          
          <!-- Translation Form -->
          <div class="mb-3">
            <label for="sourceText" class="form-label">Enter text to translate:</label>
            <textarea 
              id="sourceText" 
              class="form-control" 
              [(ngModel)]="sourceText" 
              rows="3">
            </textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Source Language:</label>
            <div class="btn-group" role="group">
              <input type="radio" class="btn-check" name="sourceLanguage" id="fijian" 
                     [(ngModel)]="sourceLanguage" value="fj" autocomplete="off">
              <label class="btn btn-outline-primary" for="fijian">Fijian</label>

              <input type="radio" class="btn-check" name="sourceLanguage" id="english" 
                     [(ngModel)]="sourceLanguage" value="en" autocomplete="off">
              <label class="btn btn-outline-primary" for="english">English</label>
            </div>
          </div>

          <button 
            class="btn btn-primary" 
            (click)="translateUsingClaude()" 
            [disabled]="isTranslating">
            {{ isTranslating ? 'Translating...' : 'Translate' }}
          </button>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="alert alert-danger mt-3">
        {{ error }}
      </div>

      <!-- Similar Translations Section -->
      <div *ngIf="similarTranslations.length > 0" class="alert alert-info mt-3">
        <h4 class="alert-heading">Similar Translations Found</h4>
        <div class="list-group mt-2">
          <div *ngFor="let translation of similarTranslations" 
               class="list-group-item list-group-item-action">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1">{{ translation.translatedText }}</h5>
              <small>
                <span [class]="translation.source === 'verified' ? 'badge bg-success' : 'badge bg-secondary'">
                  {{ translation.source === 'verified' ? 'Verified' : 'AI Generated' }}
                </span>
              </small>
            </div>
            <p class="mb-1">Original: {{ translation.sourceText }}</p>
            <button class="btn btn-sm btn-outline-primary mt-2" 
                    (click)="useExistingTranslation(translation)">
              Use This Translation
            </button>
          </div>
        </div>
      </div>

      <!-- Translation Result -->
      <div *ngIf="currentTranslation" class="card mt-3">
        <div class="card-body">
          <h5 class="card-title">Translation Result</h5>
          <p class="card-text">{{ currentTranslation.translatedText }}</p>
          <div *ngIf="currentTranslation.source === 'verified'" 
               class="alert alert-success">
            This is a verified translation
          </div>
          
          <!-- Verification Form -->
          <div class="mt-3">
            <label for="verifiedTranslation" class="form-label">Verified Translation:</label>
            <textarea 
              id="verifiedTranslation" 
              class="form-control" 
              [(ngModel)]="verifiedTranslation" 
              rows="3">
            </textarea>
            
            <button 
              class="btn btn-success mt-2" 
              (click)="verifyTranslation()" 
              [disabled]="isVerifying">
              {{ isVerifying ? 'Verifying...' : 'Submit Verification' }}
            </button>
          </div>

          <!-- Verification Success Message -->
          <div *ngIf="verificationSuccess" class="alert alert-success mt-3">
            {{ verificationSuccess }}
          </div>

          <!-- Raw Response Toggle -->
          <button 
            class="btn btn-link mt-2" 
            (click)="toggleRawResponse()">
            {{ showRawResponse ? 'Hide' : 'Show' }} Raw Response
          </button>
          
          <div *ngIf="showRawResponse" class="mt-2">
            <pre>{{ currentTranslation.rawResponse }}</pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
