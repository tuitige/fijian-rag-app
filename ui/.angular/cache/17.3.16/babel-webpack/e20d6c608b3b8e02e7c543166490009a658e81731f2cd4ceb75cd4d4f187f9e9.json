{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\nimport { HttpRequest, HttpResponse } from \"@aws-sdk/protocol-http\";\nimport { getSkewCorrectedDate } from \"./utils/getSkewCorrectedDate\";\nimport { getUpdatedSystemClockOffset } from \"./utils/getUpdatedSystemClockOffset\";\nexport var awsAuthMiddleware = function (options) {\n  return function (next, context) {\n    return function (args) {\n      var _a, _b, _c;\n      return __awaiter(this, void 0, void 0, function () {\n        var authScheme, signer, output, _d, _e, dateHeader;\n        var _f;\n        return __generator(this, function (_g) {\n          switch (_g.label) {\n            case 0:\n              if (!HttpRequest.isInstance(args.request)) return [2, next(args)];\n              authScheme = (_c = (_b = (_a = context.endpointV2) === null || _a === void 0 ? void 0 : _a.properties) === null || _b === void 0 ? void 0 : _b.authSchemes) === null || _c === void 0 ? void 0 : _c[0];\n              return [4, options.signer(authScheme)];\n            case 1:\n              signer = _g.sent();\n              _d = next;\n              _e = [__assign({}, args)];\n              _f = {};\n              return [4, signer.sign(args.request, {\n                signingDate: getSkewCorrectedDate(options.systemClockOffset),\n                signingRegion: context[\"signing_region\"],\n                signingService: context[\"signing_service\"]\n              })];\n            case 2:\n              return [4, _d.apply(void 0, [__assign.apply(void 0, _e.concat([(_f.request = _g.sent(), _f)]))]).catch(function (error) {\n                var _a;\n                var serverTime = (_a = error.ServerTime) !== null && _a !== void 0 ? _a : getDateHeader(error.$response);\n                if (serverTime) {\n                  options.systemClockOffset = getUpdatedSystemClockOffset(serverTime, options.systemClockOffset);\n                }\n                throw error;\n              })];\n            case 3:\n              output = _g.sent();\n              dateHeader = getDateHeader(output.response);\n              if (dateHeader) {\n                options.systemClockOffset = getUpdatedSystemClockOffset(dateHeader, options.systemClockOffset);\n              }\n              return [2, output];\n          }\n        });\n      });\n    };\n  };\n};\nvar getDateHeader = function (response) {\n  var _a, _b, _c;\n  return HttpResponse.isInstance(response) ? (_b = (_a = response.headers) === null || _a === void 0 ? void 0 : _a.date) !== null && _b !== void 0 ? _b : (_c = response.headers) === null || _c === void 0 ? void 0 : _c.Date : undefined;\n};\nexport var awsAuthMiddlewareOptions = {\n  name: \"awsAuthMiddleware\",\n  tags: [\"SIGNATURE\", \"AWSAUTH\"],\n  relation: \"after\",\n  toMiddleware: \"retryMiddleware\",\n  override: true\n};\nexport var getAwsAuthPlugin = function (options) {\n  return {\n    applyToStack: function (clientStack) {\n      clientStack.addRelativeTo(awsAuthMiddleware(options), awsAuthMiddlewareOptions);\n    }\n  };\n};\nexport var getSigV4AuthPlugin = getAwsAuthPlugin;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}